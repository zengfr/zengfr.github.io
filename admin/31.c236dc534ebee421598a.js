(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{BfdY:function(e,t,i){"use strict";i.r(t),i.d(t,"RoleManageModule",function(){return Z});var n=i("ofXK"),a=i("tyNb"),r=i("WyLt"),s=i("z0B0"),c=i("nYR2"),o=i("fXoL"),d=i("O/Ro"),l=i("dEAy"),b=i("vc+U"),h=i("3Pt+"),p=i("7zAA"),u=i("LRne"),g=i("ocnv"),m=i("B+r4"),f=i("PTRe");let k=(()=>{class e extends r.b{constructor(e,t){super(),this.modalRef=e,this.fb=t,this.params={}}initForm(){this.addEditForm=this.fb.group({roleName:[null,[h.r.required]],roleDesc:[null]})}getAsyncFnData(e){return Object(u.a)(e)}getCurrentValue(){return Object(p.a)(this.addEditForm)?Object(u.a)(this.addEditForm.value):Object(u.a)(!1)}ngOnInit(){this.initForm(),Object.keys(this.params).length>0&&this.addEditForm.patchValue(this.params)}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(l.b),o.Nb(h.e))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-inter-add-edit"]],features:[o.wb],decls:11,vars:1,consts:[["nz-form","",3,"formGroup"],["nzRequired","","nzFor","roleName"],["nzErrorTip","\u8bf7\u8f93\u5165\u89d2\u8272\u540d"],["nz-input","","formControlName","roleName","name","roleName","placeholder","\u8bf7\u8f93\u5165\u89d2\u8272\u540d","id","roleName"],["nzFor","roleDesc"],["nz-input","","formControlName","roleDesc","name","roleDesc","placeholder","\u8bf7\u8f93\u5165\u5907\u6ce8","id","roleDesc"]],template:function(e,t){1&e&&(o.Tb(0,"form",0),o.Tb(1,"nz-form-item"),o.Tb(2,"nz-form-label",1),o.Hc(3,"\u89d2\u8272\u540d"),o.Sb(),o.Tb(4,"nz-form-control",2),o.Ob(5,"input",3),o.Sb(),o.Sb(),o.Tb(6,"nz-form-item"),o.Tb(7,"nz-form-label",4),o.Hc(8,"\u63cf\u8ff0"),o.Sb(),o.Tb(9,"nz-form-control"),o.Ob(10,"input",5),o.Sb(),o.Sb(),o.Sb()),2&e&&o.kc("formGroup",t.addEditForm)},directives:[h.s,h.n,g.b,h.h,m.c,g.c,m.a,g.d,g.a,f.b,h.d,h.m,h.g],encapsulation:2,changeDetection:0}),e})(),z=(()=>{class e extends r.a{constructor(e){super(e),this.injector=e}getContentComponent(){return k}show(e={},t){return super.show(e,t)}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(o.r))},e.\u0275prov=o.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var S=i("pWVF"),C=i("jdUJ"),T=i("pT7D"),v=i("kcmx");const A=["operationTpl"];function I(e,t){if(1&e){const e=o.Ub();o.Tb(0,"span",6),o.ac("click",function(){o.vc(e);const t=o.dc().id;return o.dc().setRole(t)}),o.Hc(1,"\u8bbe\u7f6e\u6743\u9650"),o.Sb()}}function O(e,t){if(1&e){const e=o.Ub();o.Tb(0,"span",6),o.ac("click",function(){o.vc(e);const t=o.dc().id;return o.dc().edit(t)}),o.Hc(1,"\u7f16\u8f91"),o.Sb()}}function y(e,t){if(1&e){const e=o.Ub();o.Tb(0,"span",6),o.ac("click",function(){o.vc(e);const t=o.dc().id;return o.dc().del(t)}),o.Hc(1,"\u5220\u9664"),o.Sb()}}function w(e,t){if(1&e&&(o.Fc(0,I,2,0,"span",5),o.Fc(1,O,2,0,"span",5),o.Fc(2,y,2,0,"span",5)),2&e){const e=o.dc();o.kc("appAuth",e.ActionCode.RoleSetAuth),o.zb(1),o.kc("appAuth",e.ActionCode.RoleEdit),o.zb(1),o.kc("appAuth",e.ActionCode.RoleDel)}}let N=(()=>{class e{constructor(e,t,i,n,a,r){this.dataService=e,this.modalSrv=t,this.cdr=i,this.messageService=n,this.modalService=a,this.router=r,this.ActionCode=s.a,this.actionCodeObj={add:s.a.RoleAdd},this.pageHeaderInfo={title:"\u89d2\u8272\u7ba1\u7406",breadcrumb:["\u9996\u9875","\u5185\u90e8\u7ba1\u7406","\u89d2\u8272\u7ba1\u7406"]},this.checkedCashArray=[],this.dataList=[]}selectedChecked(e){this.checkedCashArray=[...e]}getDataList(e){this.tableConfig.loading=!0,this.dataService.getRoles({pageSize:this.tableConfig.pageSize,pageNum:(null==e?void 0:e.pageIndex)||this.tableConfig.pageIndex}).pipe(Object(c.a)(()=>{this.tableLoading(!1)})).subscribe(e=>{const{list:t,total:i,pageNum:n}=e;this.dataList=[...t],this.tableConfig.total=i,this.tableConfig.pageIndex=n,this.tableLoading(!1),this.checkedCashArray=[...this.checkedCashArray]})}setRole(e){this.router.navigate(["/default/internal-manage/role-manage/set-role",e])}tableChangeDectction(){this.dataList=[...this.dataList],this.cdr.detectChanges()}tableLoading(e){this.tableConfig.loading=e,this.tableChangeDectction()}del(e){this.modalSrv.confirm({nzTitle:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",nzContent:"\u5220\u9664\u540e\u4e0d\u53ef\u6062\u590d",nzOnOk:()=>{this.tableLoading(!0),this.dataService.delRoles(e).subscribe(()=>{1===this.dataList.length&&this.tableConfig.pageIndex--,this.getDataList()})}})}add(){this.modalService.show({nzTitle:"\u65b0\u589e"}).subscribe(e=>{e&&e.status!==r.c.Cancel&&(this.tableLoading(!0),this.addEditData(e.modalValue,"addRoles"))},e=>this.tableLoading(!1))}edit(e){this.dataService.getRolesDetail(e).subscribe(t=>{this.modalService.show({nzTitle:"\u7f16\u8f91"},t).subscribe(({modalValue:t,status:i})=>{i!==r.c.Cancel&&(t.id=e,this.tableLoading(!0),this.addEditData(t,"editRoles"))},e=>this.tableLoading(!1))})}addEditData(e,t){this.dataService[t](e).subscribe(()=>{this.getDataList()})}changePageSize(e){this.tableConfig.pageSize=e}initTable(){this.tableConfig={showCheckbox:!0,headers:[{title:"\u89d2\u8272\u540d\u79f0",field:"roleName",width:100},{title:"\u5907\u6ce8",width:100,field:"roleDesc"},{title:"\u64cd\u4f5c",tdTemplate:this.operationTpl,width:150,fixed:!0}],total:0,loading:!0,pageSize:10,pageIndex:1}}ngOnInit(){this.initTable()}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(d.a),o.Nb(l.c),o.Nb(o.h),o.Nb(b.a),o.Nb(z),o.Nb(a.j))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-role-manage"]],viewQuery:function(e,t){if(1&e&&o.Ac(A,!0),2&e){let e;o.tc(e=o.bc())&&(t.operationTpl=e.first)}},decls:6,vars:6,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],[3,"actionCode","needAddBtn","add"],[3,"checkedCashArrayFromComment","tableConfig","tableData","selectedChange","changePageSize","changePageNum"],["operationTpl",""],["class","operate-text",3,"click",4,"appAuth"],[1,"operate-text",3,"click"]],template:function(e,t){1&e&&(o.Ob(0,"app-page-header",0),o.Tb(1,"div",1),o.Tb(2,"app-card-table-wrap",2),o.ac("add",function(){return t.add()}),o.Tb(3,"app-ant-table",3),o.ac("selectedChange",function(e){return t.selectedChecked(e)})("changePageSize",function(e){return t.changePageSize(e)})("changePageNum",function(e){return t.getDataList(e)}),o.Sb(),o.Fc(4,w,3,3,"ng-template",null,4,o.Gc),o.Sb(),o.Sb()),2&e&&(o.kc("pageHeaderInfo",t.pageHeaderInfo),o.zb(2),o.kc("actionCode",t.actionCodeObj)("needAddBtn",!0),o.zb(1),o.kc("checkedCashArrayFromComment",t.checkedCashArray)("tableConfig",t.tableConfig)("tableData",t.dataList))},directives:[S.a,C.a,T.a,v.a],styles:[""],changeDetection:0}),e})();var L=i("lJxs"),D=i("5+tZ"),F=i("PScX"),R=i("JA5x"),H=i("JbsO"),j=i("OzZK"),x=i("RwU8"),P=i("C2AL"),E=i("TaO5"),M=i("FwiY"),V=i("5vDB"),J=i("Mean");function $(e,t){if(1&e&&(o.Rb(0),o.Tb(1,"label",6),o.ac("ngModelChange",function(e){return t.$implicit.checked=e}),o.Hc(2),o.Sb(),o.Qb()),2&e){const e=t.$implicit;o.zb(1),o.kc("ngModel",e.checked),o.zb(1),o.Ic(e.menuName)}}function B(e,t){if(1&e&&(o.Rb(0),o.Tb(1,"div",12),o.Tb(2,"div",13),o.Tb(3,"label",6),o.ac("ngModelChange",function(e){return t.$implicit.checked=e}),o.Hc(4),o.Sb(),o.Ob(5,"nz-divider",10),o.Sb(),o.Tb(6,"div",14),o.Hc(7," \u64cd\u4f5c\u6743\u9650\uff1a "),o.Fc(8,$,3,2,"ng-container",2),o.Sb(),o.Sb(),o.Qb()),2&e){const e=t.$implicit;o.zb(3),o.kc("ngModel",e.checked),o.zb(1),o.Ic(e.menuName),o.zb(4),o.kc("ngForOf",e.permissionVo)}}function U(e,t){if(1&e&&(o.Rb(0),o.Fc(1,B,9,3,"ng-container",2),o.Qb()),2&e){const e=o.dc().$implicit;o.zb(1),o.kc("ngForOf",e.permissionVo)}}function X(e,t){if(1&e&&(o.Rb(0),o.Tb(1,"div",5),o.Tb(2,"label",6),o.ac("ngModelChange",function(e){return t.$implicit.checked=e}),o.Hc(3),o.Sb(),o.Tb(4,"span",7),o.ac("click",function(){const e=t.$implicit;return e.isOpen=!e.isOpen}),o.Ob(5,"i",8),o.Tb(6,"span",9),o.Hc(7),o.Sb(),o.Sb(),o.Sb(),o.Ob(8,"nz-divider",10),o.Fc(9,U,2,1,"ng-container",11),o.Qb()),2&e){const e=t.$implicit;o.zb(2),o.kc("ngModel",e.checked),o.zb(1),o.Ic(e.menuName),o.zb(2),o.kc("nzType",e.isOpen?"down":"right"),o.zb(2),o.Jc(" ",e.isOpen?"\u6536\u8d77":"\u5c55\u5f00",""),o.zb(2),o.kc("ngIf",e.permissionVo.length>0&&e.isOpen)}}let G=(()=>{class e{constructor(e,t,i,n,a){this.dataService=e,this.cdr=t,this.routeInfo=i,this.router=n,this.message=a,this.pageHeaderInfo={title:"\u8bbe\u7f6e\u6743\u9650",desc:"\u5f53\u524d\u89d2\u8272\uff1a\u8d85\u7ea7\u7ba1\u7406\u5458",breadcrumb:["\u9996\u9875","\u5185\u90e8\u7ba1\u7406","\u89d2\u8272\u7ba1\u7406","\u8bbe\u7f6e\u6743\u9650"]},this.authIdArr=[],this.permissionIdArr=[]}initPermission(){this.dataService.getPermission().pipe(Object(L.a)(e=>{e.map(e=>e.isOpen=!1),this.permissionList=e}),Object(D.a)(()=>this.dataService.getPermissionById(this.id))).subscribe(e=>{this.authIdArr=e,this.getAuthIdArr(this.permissionList),this.cdr.markForCheck()})}getAuthIdArr(e,t="initAuthTree"){e.forEach(e=>{"initAuthTree"===t?e.checked=this.authIdArr.includes(e.code):"updateAuthTree"===t&&e.checked&&this.permissionIdArr.push(e.id),e.permissionVo&&e.permissionVo.length>0&&this.getAuthIdArr(e.permissionVo,t)})}getCurrenPermission(){this.getAuthIdArr(this.permissionList,"updateAuthTree"),this.dataService.updatePermission({permissionIds:this.permissionIdArr,roleId:this.id}).subscribe(()=>{this.message.success("\u7528\u6237\u767b\u5f55")})}getRoleName(){this.dataService.getRolesDetail(this.id).subscribe(({roleName:e})=>{this.pageHeaderInfo=Object.assign(Object.assign({},this.pageHeaderInfo),{desc:"\u5f53\u524d\u89d2\u8272\uff1a"+e})})}back(){this.router.navigate(["/default/internal-manage/role"])}submit(){this.permissionIdArr.length=0,this.getCurrenPermission()}_onReuseInit(){this.ngOnInit()}ngOnInit(){this.id=this.routeInfo.snapshot.params.id,this.initPermission(),this.getRoleName()}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(d.a),o.Nb(o.h),o.Nb(a.a),o.Nb(a.j),o.Nb(F.b))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-set-role"]],decls:11,vars:2,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],[4,"ngFor","ngForOf"],["nz-button","","nzType","primary",1,"right",3,"click"],["nzGhost","","nz-button","","nzType","primary",1,"right","m-l-20",3,"click"],[1,"first-menu"],["nz-checkbox","",3,"ngModel","ngModelChange"],[1,"hand-model",3,"click"],["nz-icon","","nzTheme","outline",3,"nzType"],[1,"operate-text"],[1,"m-0"],[4,"ngIf"],["nz-result-content","",1,"menu-content","m-0","p-0"],[1,"second-menu","p-l-25","li-height"],[1,"operate-line","p-l-35","li-height"]],template:function(e,t){1&e&&(o.Ob(0,"app-page-header",0),o.Tb(1,"div",1),o.Tb(2,"nz-card"),o.Tb(3,"ul"),o.Tb(4,"li"),o.Fc(5,X,10,5,"ng-container",2),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(6,"app-footer-submit"),o.Tb(7,"button",3),o.ac("click",function(){return t.submit()}),o.Hc(8,"\u63d0\u4ea4"),o.Sb(),o.Tb(9,"button",4),o.ac("click",function(){return t.back()}),o.Hc(10,"\u8fd4\u56de"),o.Sb(),o.Sb()),2&e&&(o.kc("pageHeaderInfo",t.pageHeaderInfo),o.zb(5),o.kc("ngForOf",t.permissionList))},directives:[S.a,R.a,n.m,H.a,j.a,x.a,P.a,E.a,h.m,h.p,M.b,V.a,n.n,J.b],styles:[".first-menu,.li-height{height:40px;line-height:40px}.first-menu{display:flex;justify-content:space-between;align-items:center}"],encapsulation:2,changeDetection:0}),e})();var K=i("hY/X");const Q=[{path:"set-role/:id",canDeactivate:[(()=>{class e{canActivate(e,t){return!0}canDeactivate(e,t,i,n){return"role"===Object(p.b)(n.url)&&"set-role"===Object(p.b)(i.url)&&(K.a.waitDelete="set-role",K.a.deleteRouteSnapshot("set-role")),!0}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()],component:G,data:{title:"\u89d2\u8272\u7ba1\u7406",key:"set-role",relatedLink:["role-manage","set-role"]}},{path:"",component:N,data:{title:"\u89d2\u8272\u7ba1\u7406",key:"role-manage",relatedLink:["role-manage","set-role"]}}];let Y=(()=>{class e{}return e.\u0275mod=o.Lb({type:e}),e.\u0275inj=o.Kb({factory:function(t){return new(t||e)},imports:[[a.n.forChild(Q)],a.n]}),e})();var q=i("yCTO");i("Agio"),i("9suT"),i("5G3X");let W=(()=>{class e{}return e.\u0275mod=o.Lb({type:e}),e.\u0275inj=o.Kb({factory:function(t){return new(t||e)},imports:[[n.c,q.a]]}),e})(),Z=(()=>{class e{}return e.\u0275mod=o.Lb({type:e}),e.\u0275inj=o.Kb({factory:function(t){return new(t||e)},imports:[[n.c,q.a,W,Y]]}),e})()}}]);